{"ast":null,"code":"var _jsxFileName = \"/Users/ioannischionas/Code/springboot/cineProject/demo-frontend/src/pages/Login.js\",\n    _s = $RefreshSig$();\n\nimport { useRef, useState, useEffect } from 'react';\nimport useAuth from '../hooks/useAuth';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport axios from '../api/axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LOGIN_URL = '/auth/authenticate';\nexport default function Login() {\n  _s();\n\n  var _location$state, _location$state$from;\n\n  const {\n    setAuth\n  } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : (_location$state$from = _location$state.from) === null || _location$state$from === void 0 ? void 0 : _location$state$from.pathname) || \"/\";\n  const userRef = useRef();\n  const errRef = useRef();\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [errMsg, setErrMsg] = useState('');\n  useEffect(() => {\n    userRef.current.focus();\n  }, []);\n  useEffect(() => {\n    setErrMsg('');\n  }, [username, password]);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n\n    try {\n      var _response$data, _user$data, _user$data2, _user$data3;\n\n      const response = await await axios({\n        method: \"POST\",\n        url: LOGIN_URL,\n        headers: {},\n        data: {\n          \"email\": username,\n          \"password\": password\n        }\n      });\n      console.log(response);\n      const access_token = response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.token; //const refresh_token = response?.data?.refresh_token;\n\n      console.log(access_token);\n      const user = await axios.get(`http://localhost:8080/api/users/${username}`, {\n        headers: {\n          'Authorization': `Bearer ${access_token}`\n        }\n      });\n      const roles = [user === null || user === void 0 ? void 0 : (_user$data = user.data) === null || _user$data === void 0 ? void 0 : _user$data.role];\n      const firstname = user === null || user === void 0 ? void 0 : (_user$data2 = user.data) === null || _user$data2 === void 0 ? void 0 : _user$data2.firstname;\n      const lastname = user === null || user === void 0 ? void 0 : (_user$data3 = user.data) === null || _user$data3 === void 0 ? void 0 : _user$data3.lastname;\n      console.log(roles);\n      setAuth({\n        username,\n        firstname,\n        lastname,\n        password,\n        roles,\n        access_token\n      });\n      setUsername('');\n      setPassword('');\n      navigate(from, {\n        replace: true\n      });\n    } catch (err) {\n      var _err$response;\n\n      if (!(err !== null && err !== void 0 && err.response)) {\n        setErrMsg('No Server Response');\n      } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        setErrMsg('Invalid Credentials');\n      } else {\n        setErrMsg('Login Failed');\n      }\n\n      errRef.current.focus();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      ref: errRef,\n      className: errMsg ? \"errmsg\" : \"offscreen\",\n      \"aria-live\": \"assertive\",\n      children: errMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Sign in\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"username\",\n        children: \"Email:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"username\",\n        ref: userRef,\n        autoComplete: \"off\",\n        onChange: e => setUsername(e.target.value),\n        value: username,\n        required: true,\n        placeholder: \"Enter your username\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        id: \"password\",\n        onChange: e => setPassword(e.target.value),\n        value: password,\n        required: true,\n        placeholder: \"Enter your password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: \"Sign in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Need an acount?\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 32\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"line\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/register\",\n          children: \"Sign Up\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Login, \"Jss26DyXJ9gg0jVC74v/Xrc54hA=\", false, function () {\n  return [useAuth, useNavigate, useLocation];\n});\n\n_c = Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["useRef","useState","useEffect","useAuth","Link","useNavigate","useLocation","axios","LOGIN_URL","Login","setAuth","navigate","location","from","state","pathname","userRef","errRef","username","setUsername","password","setPassword","errMsg","setErrMsg","current","focus","handleSubmit","e","preventDefault","response","method","url","headers","data","console","log","access_token","token","user","get","roles","role","firstname","lastname","replace","err","status","target","value"],"sources":["/Users/ioannischionas/Code/springboot/cineProject/demo-frontend/src/pages/Login.js"],"sourcesContent":["import { useRef, useState, useEffect } from 'react';\nimport useAuth from '../hooks/useAuth';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\n\nimport axios from '../api/axios';\nconst LOGIN_URL = '/auth/authenticate';\n\nexport default function Login() {\n\n    const { setAuth } = useAuth();\n\n    const navigate = useNavigate();\n    const location = useLocation();\n    const from = location.state?.from?.pathname || \"/\";\n\n    const userRef = useRef();\n    const errRef = useRef();\n\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    const [errMsg, setErrMsg] = useState('');\n\n    useEffect(() => {\n        userRef.current.focus();\n    }, [])\n\n    useEffect(() => {\n        setErrMsg('');\n    }, [username, password])\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n\n        try {\n            const response = await (await axios({\n                method: \"POST\",\n                url: LOGIN_URL,\n                headers: {},\n                data: {\n                    \"email\": username,\n                    \"password\": password,\n                }\n            }));\n            console.log(response);\n\n            const access_token = response?.data?.token;\n            //const refresh_token = response?.data?.refresh_token;\n            console.log(access_token);\n            const user = await axios.get(`http://localhost:8080/api/users/${username}`, {\n                headers: {\n                    'Authorization': `Bearer ${access_token}`\n                }\n            })\n            const roles = [user?.data?.role];\n            const firstname =user?.data?.firstname;\n            const lastname =user?.data?.lastname;\n            console.log(roles);\n            setAuth({ username, firstname, lastname, password, roles, access_token, });\n            setUsername('');\n            setPassword('');\n            navigate(from, { replace: true });\n        } catch (err) {\n            if (!err?.response) {\n                setErrMsg('No Server Response');\n            } else if (err.response?.status === 401) {\n                setErrMsg('Invalid Credentials');\n            } else {\n                setErrMsg('Login Failed');\n            }\n            errRef.current.focus();\n        }\n    }\n\n    return (\n        <section>\n            <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\n            <h1>Sign in</h1>\n            <form onSubmit={handleSubmit}>\n                <label htmlFor=\"username\">Email:</label>\n                <input\n                    type=\"text\"\n                    id=\"username\"\n                    ref={userRef}\n                    autoComplete='off'\n                    onChange={(e) => setUsername(e.target.value)}\n                    value={username}\n                    required\n                    placeholder=\"Enter your username\"\n                />\n                <label htmlFor=\"password\">Password:</label>\n                <input\n                    type=\"password\"\n                    id=\"password\"\n                    onChange={(e) => setPassword(e.target.value)}\n                    value={password}\n                    required\n                    placeholder=\"Enter your password\"\n                />\n                <button>Sign in</button>\n            </form>\n            <p>\n                Need an acount?<br />\n                <span className=\"line\">\n                    <Link to=\"/register\">Sign Up</Link>\n                </span>\n            </p>\n        </section >\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}